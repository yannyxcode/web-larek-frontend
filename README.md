# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- `src/` — исходные файлы проекта
- `src/components/` — папка с JS компонентами
- `src/components/base/` — папка с базовым кодом

Важные файлы:
- `src/pages/index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/index.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
<br>
<hr>

# <p align="center"> Архитектура приложения </p>

#### Приложение разработано с использованием архитектурного подхода MVP (Model-View-Presenter), <br> который разделяет различные аспекты логики приложения для обеспечения гибкости и удобства тестирования.

- **Model** — отвечает за работу с данными и их взаимодействие с сервером.
- **View** — отображает данные и обрабатывает действия пользователя.
- **Presenter** — служит посредником, обеспечивающим связь между слоем данных (Model) и слоем представления (View).
<br> <hr>
# <p align="center"> Базовые классы </p>

## Класс `Api`
Класс `Api` служит для взаимодействия с сервером через HTTP-запросы. Основная его цель — предоставление удобных методов для отправки запросов и обработки ответов.

### Поля:
- `baseUrl: string` Базовый URL для API, который используется в запросах.
- `options: RequestInit` Опции для запроса, включая заголовки и другие параметры.

### Методы:
- `get` Выполняет GET-запрос на указанный в параметрах endpoint и возвращает промис с ответом 
  от сервера.
- `post` Отправляет данные в формате JSON на указанный endpoint. Можно указать метод запроса, 
  если это необходимо (по умолчанию используется POST).
-  `handleResponse` Обрабатывает ответ от API. Если ответ успешный, возвращает JSON. В противном случае возвращает ошибку.

<br>
<hr>


## Класс `EventEmitter`
Класс для работы с событиями в приложении, который позволяет генерировать и подписываться на события. Он активно используется в презентере для обработки событий.

### Поля:
- `_events: Map<EventName, Set<Subscriber>>` Хранит события и соответствующие им наборы 
  подписчиков. Ключом является имя события (или регулярное выражение), а значением — набор функций-обработчиков.

### Методы:
- `on` Устанавливает обработчик для указанного события.
- `off` Удаляет обработчик для указанного события.
- `emit` Инициирует событие и вызывает все соответствующие обработчики с переданными данными.
- `onAll` Устанавливает обработчик для всех событий. Обработчик будет вызван при инициировании любого события.
- `offAll` Сбрасывает все обработчики событий.
- `trigger` Возвращает функцию-коллбек, которая инициирует событие с указанным именем и контекстом при вызове.
- `constructor()` Конструктор класса, инициализирует пустую карту для хранения событий и подписчиков.

<br>
<hr>

## Класс `Component`

Абстрактный класс `Component` служит базовым классом для создания компонентов, работающих с DOM. Он предоставляет набор методов для манипуляции элементами, такими как установка текста, управление видимостью и состоянием блокировки..

### Поля: 
- `container: HTMLElement` Корневой элемент DOM, в котором будет размещен компонент. 
Инициализируется через конструктор и доступен для дочерних классов.

### Методы:
- `constructor(protected readonly container: HTMLElement)` Конструктор класса, который инициализирует корневой элемент компонента.
- `protected setText(element: HTMLElement, value: unknown)` Устанавливает текстовое содержимое 
  указанного элемента.
- `setDisabled(element: HTMLElement, state: boolean)` Устанавливает состояние блокировки для 
  указанного элемента. 
- `protected setHidden(element: HTMLElement)` Скрывает указанный элемент, устанавливая его стиль display в none.
- `protected setVisible(element: HTMLElement)` Показывает указанный элемент, удаляя свойство display.
- `protected setImage(element: HTMLImageElement, src: string, alt?: string)` Устанавливает изображение для указанного элемента с заданным источником и альтернативным текстом.



<br>
<hr>

## Класс `Model`
Класс `Model` Cлужит базовым классом для создания моделей данных. Он позволяет отличать модели 
от простых объектов и предоставляет механизм для уведомления об изменениях в данных через события.

### Поля:
- `events: IEvents` Интерфейс для работы с событиями. Используется для уведомления об изменениях в 
модели.

### Методы:
- `emitChanges` Уведомляет подписчиков о том, что данные модели были изменены.

<br>
<hr>

# <p align="center"> Работа с данными </p>

## Класс `LarekApi`
Класс `LarekApi` является важной частью архитектуры приложения, так как он обеспечивает связь между клиентом и сервером. Он позволяет получать данные о товарах и отправлять информацию о заказах, что делает его ключевым компонентом для функциональности электронной коммерции.


### Методы:
- `getProductItems(): Promise` Выполняет запрос для получения списка товаров. Этот метод позволяет загружать данные о товарах из API и использовать их в приложении.
- `order(order: IOrder): Promise` Выполняет запрос для создания заказа c указанными данными. Возвращает результат выполнения заказа. 



<br>
<hr>


## Класс `AppState`
Модель данных приложения, которая отвечает за хранение, обработку и управление состоянием данных, а также за методы для их модификации.

### Интерфейс функционала приложения:
```typescript
export interface IAppState {
    basket: IBasketItem[]; 
    catalog: ICatalogItem[]; 
    loading: boolean; 
    order: IOrder; 
    preview: string | null; 
    formErrors: FormErrors; 
}
```


### Поля:
- `basket: IBasketItem[]` Массив товаров, добавленных в корзину.
- `catalog: ICatalogItem[]` Массив товаров в каталоге.
- `loading: boolean` Статус загрузки данных.
- `order: IOrder` Объект, представляющий заказ. Содержит информацию о способе оплаты, адресе, email, телефоне, общей сумме и товарах в заказе.
- `preview: string | null` Идентификатор товара для предварительного просмотра.
- `formErrors: FormErrors` Объект, содержащий ошибки валидации форм. 

### Методы:
- `addToBasket(item: IBasketItem)` Добавляет товар в корзину, если его цена не равна null и он 
еще не находится в корзине. После добавления вызывает события об изменении корзины и счетчика.
- `removeBasketItem(item: IBasketItem)` Удаляет товар из корзины. После удаления вызывает события 
об изменении корзины и счетчика.
- `clearBasket()` Очищает корзину, удаляя все товары. Вызывает события об изменении корзины и счетчика.
- `getTotal()` Возвращает общую сумму всех товаров в корзине.
- `setCatalog(items: ICard[])` Устанавливает каталог товаров и вызывает событие об изменении 
элементов каталога.
- `setPreview(item: ICard)` Устанавливает предварительный просмотр для выбранного товара и 
вызывает событие об изменении предварительного просмотра.
- `validateOrderForm()` Проверяет форму заказа на наличие ошибок. Если есть ошибки, они сохраняются 
в formErrors, и вызывается событие об изменении ошибок формы. Возвращает true, если форма валидна, и false в противном случае.
- `setOrderField(field: keyof IOrder, value: string | number)` Устанавливает значение для указанного 
поля заказа. Если форма валидна, вызывает событие об успешном заказе.
- `resetContacts()` Сбрасывает поля контактов (email и телефон) в заказе.

<br>
<hr>


# <p align="center"> Слой отображения </p>

## Класс `Page`
Класс `Page` предназначен для управления состоянием и отображением страницы приложения. Он 
обеспечивает взаимодействие между элементами интерфейса, такими как счетчик товаров в корзине и каталог товаров. Класс позволяет обновлять содержимое страницы в ответ на действия пользователя, такие как добавление товаров в корзину или изменение состояния страницы. Это помогает создать динамичный и отзывчивый интерфейс, улучшая пользовательский опыт.

### Поля:

- `_counter: HTMLElement` Элемент, отображающий количество товаров в корзине.
- `_catalog: HTMLElement` Элемент, представляющий каталог товаров на странице.`
- `_wrapper: HTMLElement` Обертка для содержимого страницы, которая может быть заблокирована или разблокирована.
- `_basket: HTMLElement` Элемент отоброжения корзины, на которую можно кликнуть для открытия.



### Методы:

- `set counter(value: number)` Устанавливает количество товаров в корзине.
- `set catalog(items: HTMLElement[])` Устанавливает элементы каталога, заменяя текущее содержимое на новые элементы.
- `set locked(value: boolean)` Блокирует или разблокирует обертку страницы в зависимости от 
переданного значения. 




<br>
<hr>


## Класс `Card`
Класс `Card` предназначен для представления информации о товаре в виде карточки на странице. Он управляет отображением различных свойств товара, таких как название, изображение, цена и категория, а также обрабатывает действия пользователя, такие как добавление товара в корзину. Это позволяет создать динамичный и интерактивный интерфейс для пользователей, улучшая их опыт взаимодействия с приложением.

### Поля:
- `_title: HTMLElement` Элемент, отображающий название товара.
- `_image?: HTMLImageElement` Элемент изображения товара.
- `_category?: HTMLElement` Элемент, отображающий категорию товара.
- `_description?: HTMLElement` Элемент, отображающий описание товара. 
- `_price: HTMLElement` Элемент, отображающий цену товара.
- `_button?: HTMLButtonElement` Кнопка для добавления товара в корзину. 
- `_basketCardIndex?: HTMLElement` Элемент, отображающий индекс товара в корзине.
- `_buttonTitle?: HTMLButtonElement` Элемент, отображающий название кнопки.


### Методы:
- Класс представляет сеттеры и геттеры для получения и усиановки значений у различных свойств 
  товаров.

- - `set title(value: string)` Устанавливает название товара.
- - `get price(): number` Возвращает цену товара.


<br>
<hr>


## Класс `Modal`
Класс `Modal` представляет собой компонент модального окна. 
Он отвечает за отображение контента в виде всплывающего окна, 
которое может быть открыто и закрыто пользователем.
Благодаря слушателям, закрывает модальные окно по клику вне окна, по оверлей, и по клику на крестик.

### Поля: 

- `_content: HTMLElement` Элемент, содержащий контент модального окна.
- `_closeButton: HTMLButtonElement` Кнопка для закрытия модального окна.

### Методы:
- `open` Открывает модальное окно.
- `close` Закрывает модальное окно.
- `render` Рендерит модальное окно с переданными данными о контентк.
- `set` Устанавливает контент для модального окна.


<br>
<hr>

## Класс `Basket`
Класс `Basket` управляет корзиной товаров, отображая добавленные товары, их стоимость и общую 
сумму, так же включает кнопку для оформления заказа.

### Поля:
- `_list: HTMLElement` Элемент для списка товаров в корзине.
- `_total: HTMLElement` Элемент для отображения общей стоимости всех товаров в корзине.
- `_button: HTMLButtonElement` Кнопка, которая использована для выполнения действий с корзиной, переход к оформлению заказа.



### Методы:
- `set items(items: HTMLElement[])` Устанавливает список элементов в корзине. 
- `set total(total: number)` Устанавливает общую сумму товаров в корзине и обновляет 
  соответствующий элемент.
- `set selected(items: IBasketItem[])` Устанавливает состояние кнопки в зависимости от того, 
  есть ли выбранные товары в корзине. Если товары есть, кнопка активируется; если нет — деактивируется.



<br>
<hr>


## Класс `Form`
Класс `Form` предназначен для управления формами и их состоянием.

### Поля:

- `_submit:` HTMLButtonElement Кнопка отправки формы.
- `_errors:` HTMLElement Элемент, отображающий ошибки валидации формы.


### Методы:
- `onInputChange(field: keyof T, value: string)` Обрабатывает изменения в полях формы. 
Вызывает событие изменения для соответствующего поля.
- `set valid(value: boolean)` Устанавливает состояние кнопки отправки формы (активна/неактивна) в 
зависимости от валидности формы.
- `set errors(value: string)` Устанавливает текст ошибок валидации в соответствующий элемент.
- `render(state: Partial<T> & IFormState)` Отображает форму с переданным состоянием, 
обновляя значения полей и ошибки. Возвращает контейнер формы.





<br>
<hr>


## Класс `Order`
Класс `Order` включает методы для установки данных эл. почты, номера телефона, адреса и управление 
выбором оплаты.


### Поля:
- `_payment: HTMLButtonElement[]` Массив кнопок, представляющих различные способы оплаты.


### Методы:
- `set address(value: string)` Устанавливает адрес доставки в соответствующее поле формы.
- `set email(value: string)` Устанавливает email покупателя в соответствующее поле формы.
- `set phone(value: string)` Устанавливает телефон покупателя в соответствующее поле формы.
- `set valid(value: boolean)` Устанавливает состояние кнопки отправки формы активна/неактивна в зависимости от валидности формы.
- `selected(name: string)` Устанавливает выбранный способ оплаты, обновляя классы кнопок и вызывая событие изменения способа оплаты.


<br>
<hr>

## Класс `Success`
Класс `Success` предназначен для отображения сообщения об успешном завершении заказа или другого действия.


### Поля:

- `_total: HTMLElement` Элемент, отображающий общую сумму заказа о завершенном действии.
- `_closeButton: HTMLButtonElement` Кнопка для закрытия сообщения об успешном завершении.



### Методы:
- `set total(value: string)` Устанавливает текстовое содержимое, отображет общую 
сумму или сообщение об успешном завершении.



